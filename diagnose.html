<!DOCTYPE html>
<html>
<head>
    <title>AirVisual Dashboard Diagnostics</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .result { margin: 20px 0; padding: 10px; border: 1px solid #ccc; background: #f9f9f9; }
        button { padding: 10px; margin: 5px; }
        pre { white-space: pre-wrap; word-break: break-word; }
    </style>
</head>
<body>
    <div class="container">
        <h1>AirVisual Dashboard Diagnostics</h1>
        
        <div>
            <h2>Test Endpoints</h2>
            <button id="test-local">Test Local Data</button>
            <button id="test-server">Test Log Server</button>
            <button id="test-config">Load Local Config</button>
        </div>
        
        <div class="result" id="result">
            <p>Results will appear here...</p>
        </div>
    </div>
    
    <script>
        // Helper to update result area
        function updateResult(message, data) {
            const resultElement = document.getElementById('result');
            if (data) {
                resultElement.innerHTML = `<h3>${message}</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
            } else {
                resultElement.innerHTML = `<h3>${message}</h3>`;
            }
        }
        
        // Test local data endpoint
        document.getElementById('test-local').addEventListener('click', async () => {
            updateResult('Testing local data endpoint...');
            try {
                const endpoints = [
                    '/data',
                    'data',
                    'http://localhost:8000/data',
                    'http://127.0.0.1:8000/data'
                ];
                
                let results = {};
                for (const url of endpoints) {
                    try {
                        const response = await fetch(url);
                        const data = await response.json();
                        results[url] = {
                            status: response.status,
                            ok: response.ok,
                            data: data
                        };
                    } catch (error) {
                        results[url] = {
                            error: error.message
                        };
                    }
                }
                
                updateResult('Local Data Test Results', results);
            } catch (error) {
                updateResult('Error testing endpoints', { error: error.message });
            }
        });
        
        // Test log server
        document.getElementById('test-server').addEventListener('click', async () => {
            updateResult('Testing log server...');
            try {
                const endpoints = [
                    'http://localhost:8088',
                    'http://localhost:8088/list-logs',
                    'http://localhost:8088/get-config'
                ];
                
                let results = {};
                for (const url of endpoints) {
                    try {
                        const response = await fetch(url);
                        const data = await response.text();
                        results[url] = {
                            status: response.status,
                            ok: response.ok,
                            contentType: response.headers.get('content-type'),
                            data: data.substring(0, 200) + '...' // Truncate long responses
                        };
                    } catch (error) {
                        results[url] = {
                            error: error.message
                        };
                    }
                }
                
                updateResult('Log Server Test Results', results);
            } catch (error) {
                updateResult('Error testing log server', { error: error.message });
            }
        });
        
        // Load and display local config
        document.getElementById('test-config').addEventListener('click', () => {
            updateResult('Loading local configuration...');
            
            // Try to load from localStorage
            try {
                const storedConfig = localStorage.getItem('app_config');
                if (storedConfig) {
                    const parsedConfig = JSON.parse(storedConfig);
                    updateResult('Configuration from localStorage', parsedConfig);
                } else {
                    updateResult('No configuration found in localStorage');
                }
            } catch (error) {
                updateResult('Error loading configuration', { error: error.message });
            }
        });
    </script>
</body>
</html> 